.bubble {
  --bubble-background: #ffffff;
  position: relative;
  min-height: 30PX;
  z-index: 0;

  &.-last.-masked &__content>* {
    margin-left: 7PX;
  }

  &.-last.-masked &__content>.raw {
    margin-left: 0;
  }

  &.-out.-last.-masked &__content>* {
    margin-left: 0;
    margin-right: 7PX;
  }

  &.-out.-last.-masked &__content>.raw {
    margin-right: 0;
  }

  &__shadow {
    display: block;
    position: absolute;
    top: -10PX;
    left: -10PX;
    right: -10PX;
    bottom: -10PX;
    border-style: solid;
    border-width: 25PX;
    z-index: 0;
    border-image: url(./images/shadow_in-central.png) 49 49 49 49 fill;
  }

  & &__background {
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    background: var(--bubble-background);
    z-index: 1;
  }

  & &__background,
  & &__content {
    border-radius: 6PX 12.5PX 12.5PX 6PX;
  }

  &.-first &__background,
  &.-first &__content {
    border-top-left-radius: 12.5PX;
  }

  &.-last &__background,
  &.-last &__content {
    border-bottom-left-radius: 0;
  }

  &.-last &__background::after {
    position: absolute;
    left: -7PX;
    width: 7PX;
    bottom: 0;
    height: 17PX;
    content: '';
    background-image: url(./images/bubble_tail-in.png);
    background-size: 100%;
  }

  &.-out &__background,
  &.-out &__content {
    border-radius: 12.5PX 6PX 6PX 12.5PX;
  }

  &.-out.-first &__background,
  &.-out.-first &__content {
    border-top-right-radius: 12.5PX;
  }

  &.-out.-last &__background,
  &.-out.-last &__content {
    border-bottom-right-radius: 0;
  }

  &.-out.-last &__background::after {
    background-image: url(./images/bubble_tail-out.png);
    left: auto;
    right: -7PX;
  }

  // masks
  &:not(.-last) &__content,
  &:not(.-masked) &__content {
    overflow: hidden;
  }

  &.-last.-masked &__content {
    margin-left: -7PX;
    mask-border: url(./images/bubble_in-last.png) 30 30 30 43 / 15px 15px 15px 21px;
  }

  &.-first.-last.-masked &__content {
    mask-border: url(./images/bubble_in-first-last.png) 30 30 30 43 / 15px 15px 15px 21px;
  }

  &.-out.-last.-masked &__content {
    margin-left: 0;
    margin-right: -7PX;
    mask-border: url(./images/bubble_out-last.png) 30 43 30 30 / 15px 21px 15px 15px;
  }

  &.-out.-first.-last.-masked &__content {
    mask-border: url(./images/bubble_out-first-last.png) 30 43 30 30 / 15px 21px 15px 15px;
  }

  // shadows
  &.-first &__shadow {
    border-image: url(./images/shadow_in-upper.png) 49 49 49 49 fill;
  }

  &.-last &__shadow {
    border-image: url(./images/shadow_in-lower.png) 49 49 49 49 fill;
  }

  &.-first.-last &__shadow {
    border-image: url(./images/shadow_in-whole.png) 49 49 49 49 fill;
  }

  &.-out &__shadow {
    border-image: url(./images/shadow_out-central.png) 49 49 49 49 fill;
  }

  &.-out.-first &__shadow {
    border-image: url(./images/shadow_out-upper.png) 49 49 49 49 fill;
  }

  &.-out.-last &__shadow {
    border-image: url(./images/shadow_out-lower.png) 49 49 49 49 fill;
  }

  &.-out.-first.-last &__shadow {
    border-image: url(./images/shadow_out-whole.png) 49 49 49 49 fill;
  }

  &.-out {
    --bubble-background: #eeffde;
    --accent-color: #4fae4f;
    --accent-color-inactive: #4fae4f;
    --voice-message-bar: rgb(79, 174, 79);
    --voice-message-bar-transparent: rgba(79, 174, 79, 0.5);
  }

  & &__content {
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 2;
  }

  // Fallback for browsers that don't support mask-border (e.g. Firefox)
  @supports not(mask-border: url()) {
    &.-last.-masked, &.-out.-last.-masked {
      margin-left: 0;
      margin-right: 0;
    }

    &.-last.-masked &__content, &.-out.-last.-masked &__content {
      overflow: hidden;
      margin-left: 0;
      margin-right: 0;
    }

    &.-last.-masked &__content {
      border-bottom-left-radius: 6PX;
    }

    &.-out.-last.-masked &__content {
      border-bottom-left-radius: 12.5PX;
      border-bottom-right-radius: 6PX;
    }

    &.-last.-masked &__background {
      margin-left: 0;
      margin-right: 0;
      border-bottom-left-radius: 12.5px;
      border-bottom-right-radius: 12.5px;
      &::after { content:none; }
    }

    &.-last.-masked &__content>* {
      margin-left: 0;
      margin-right: 0;
    }

    &.-last.-masked &__shadow {
      border-image: url(./images/shadow_in-central.png) 49 49 49 49 fill;
    }
  
    &.-first.-last.-masked &__shadow {
      border-image: url(./images/shadow_in-upper.png) 49 49 49 49 fill;
    }
  
    &.-out.-last.-masked &__shadow {
      border-image: url(./images/shadow_out-central.png) 49 49 49 49 fill;
    }
  
    &.-out.-first.-last.-masked &__shadow {
      border-image: url(./images/shadow_out-upper.png) 49 49 49 49 fill;
    }
  }
}
